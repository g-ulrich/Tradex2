(function(r,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(r=typeof globalThis<"u"?globalThis:r||self,s(r.TrendLine={}))})(this,function(r){"use strict";var x=Object.defineProperty;var f=(r,s,h)=>s in r?x(r,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):r[s]=h;var n=(r,s,h)=>(f(r,typeof s!="symbol"?s+"":s,h),h);class s{constructor(t,e,i,o,l){n(this,"_p1");n(this,"_p2");n(this,"_text1");n(this,"_text2");n(this,"_options");this._p1=t,this._p2=e,this._text1=i,this._text2=o,this._options=l}draw(t){t.useBitmapCoordinateSpace(e=>{if(this._p1.x===null||this._p1.y===null||this._p2.x===null||this._p2.y===null)return;const i=e.context,o=Math.round(this._p1.x*e.horizontalPixelRatio),l=Math.round(this._p1.y*e.verticalPixelRatio),a=Math.round(this._p2.x*e.horizontalPixelRatio),_=Math.round(this._p2.y*e.verticalPixelRatio);i.lineWidth=this._options.width,i.strokeStyle=this._options.lineColor,i.beginPath(),i.moveTo(o,l),i.lineTo(a,_),i.stroke(),this._options.showLabels&&(this._drawTextLabel(e,this._text1,o,l,!0),this._drawTextLabel(e,this._text2,a,_,!1))})}_drawTextLabel(t,e,i,o,l){t.context.font="24px Arial",t.context.beginPath();const a=5*t.horizontalPixelRatio,_=t.context.measureText(e),p=l?_.width+a*4:0;t.context.fillStyle=this._options.labelBackgroundColor,t.context.roundRect(i+a-p,o-24,_.width+a*2,24+a,5),t.context.fill(),t.context.beginPath(),t.context.fillStyle=this._options.labelTextColor,t.context.fillText(e,i+a*2-p,o)}}class h{constructor(t){n(this,"_source");n(this,"_p1",{x:null,y:null});n(this,"_p2",{x:null,y:null});this._source=t}update(){const t=this._source._series,e=t.priceToCoordinate(this._source._p1.price),i=t.priceToCoordinate(this._source._p2.price),o=this._source._chart.timeScale(),l=o.timeToCoordinate(this._source._p1.time),a=o.timeToCoordinate(this._source._p2.time);this._p1={x:l,y:e},this._p2={x:a,y:i}}renderer(){return new s(this._p1,this._p2,""+this._source._p1.price.toFixed(1),""+this._source._p2.price.toFixed(1),this._source._options)}}const u={lineColor:"rgb(0, 0, 0)",width:6,showLabels:!0,labelBackgroundColor:"rgba(255, 255, 255, 0.85)",labelTextColor:"rgb(0, 0, 0)"};class d{constructor(t,e,i,o,l){n(this,"_chart");n(this,"_series");n(this,"_p1");n(this,"_p2");n(this,"_paneViews");n(this,"_options");n(this,"_minPrice");n(this,"_maxPrice");this._chart=t,this._series=e,this._p1=i,this._p2=o,this._minPrice=Math.min(this._p1.price,this._p2.price),this._maxPrice=Math.max(this._p1.price,this._p2.price),this._options={...u,...l},this._paneViews=[new h(this)]}autoscaleInfo(t,e){const i=this._pointIndex(this._p1),o=this._pointIndex(this._p2);return i===null||o===null||e<i||t>o?null:{priceRange:{minValue:this._minPrice,maxValue:this._maxPrice}}}updateAllViews(){this._paneViews.forEach(t=>t.update())}paneViews(){return this._paneViews}_pointIndex(t){const e=this._chart.timeScale().timeToCoordinate(t.time);return e===null?null:this._chart.timeScale().coordinateToLogical(e)}}r.TrendLine=d,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
