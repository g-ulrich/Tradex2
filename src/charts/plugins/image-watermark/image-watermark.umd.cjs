(function(s,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(s=typeof globalThis<"u"?globalThis:s||self,i(s.ImageWatermark={}))})(this,function(s){"use strict";var x=Object.defineProperty;var U=(s,i,r)=>i in s?x(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r;var t=(s,i,r)=>(U(s,typeof i!="symbol"?i+"":i,r),r);class i{constructor(e,n){t(this,"_source");t(this,"_view");this._source=e,this._view=n}draw(e){e.useMediaCoordinateSpace(n=>{const h=n.context,a=this._view._placement;if(a){if(!this._source._imgElement)throw new Error("Image element missing.");h.globalAlpha=this._source._options.alpha??1,h.drawImage(this._source._imgElement,a.x,a.y,a.width,a.height)}})}}class r{constructor(e){t(this,"_source");t(this,"_placement",null);this._source=e}zOrder(){return"bottom"}update(){this._placement=this._determinePlacement()}renderer(){return new i(this._source,this)}_determinePlacement(){if(!this._source._chart)return null;const e=this._source._chart.priceScale("left").width(),n=this._source._chart.timeScale().width(),h=e,a=this._source._chart.chartElement().clientHeight-this._source._chart.timeScale().height(),o=Math.round(n/2)+h,w=Math.round(a/2)+0,m=this._source._options.padding??0;let c=n-2*m,_=a-2*m;this._source._options.maxHeight&&(_=Math.min(_,this._source._options.maxHeight)),this._source._options.maxWidth&&(c=Math.min(c,this._source._options.maxWidth));const f=c/this._source._imageWidth,E=_/this._source._imageHeight,u=Math.min(f,E),d=this._source._imageWidth*u,g=this._source._imageHeight*u,W=o-.5*d,H=w-.5*g;return{x:W,y:H,height:g,width:d}}}class p{constructor(e,n){t(this,"_paneViews");t(this,"_imgElement",null);t(this,"_imageUrl");t(this,"_options");t(this,"_imageHeight",0);t(this,"_imageWidth",0);t(this,"_chart",null);t(this,"_containerElement",null);t(this,"_requestUpdate");this._imageUrl=e,this._options=n,this._paneViews=[new r(this)]}attached({chart:e,requestUpdate:n}){this._chart=e,this._requestUpdate=n,this._containerElement=e.chartElement(),this._imgElement=new Image,this._imgElement.onload=()=>{var h,a;this._imageHeight=((h=this._imgElement)==null?void 0:h.naturalHeight)??1,this._imageWidth=((a=this._imgElement)==null?void 0:a.naturalWidth)??1,this._paneViews.forEach(o=>o.update()),this.requestUpdate()},this._imgElement.src=this._imageUrl}detached(){this._imgElement=null}requestUpdate(){this._requestUpdate&&this._requestUpdate()}updateAllViews(){this._paneViews.forEach(e=>e.update())}paneViews(){return this._paneViews}}s.ImageWatermark=p,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
