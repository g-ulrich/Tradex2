(function(a,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("lightweight-charts")):typeof define=="function"&&define.amd?define(["exports","lightweight-charts"],r):(a=typeof globalThis<"u"?globalThis:a||self,r(a.RoundedCandlesSeries={},a.LightweightCharts))})(this,function(a,r){"use strict";var W=Object.defineProperty;var D=(a,r,p)=>r in a?W(a,r,{enumerable:!0,configurable:!0,writable:!0,value:p}):a[r]=p;var C=(a,r,p)=>(D(a,typeof r!="symbol"?r+"":r,p),p);function p(o,t){if(o>=2.5&&o<=4)return Math.floor(3*t);const s=1-.2*Math.atan(Math.max(4,o)-4)/(Math.PI*.5),f=Math.floor(o*s*t),h=Math.floor(o*t),c=Math.min(f,h);return Math.max(Math.floor(t),c)}function S(o,t){let i=p(o,t);return i>=2&&Math.floor(t)%2!==i%2&&i--,i}function m(o){return Math.max(1,Math.floor(o))}function M(o){return m(o)/o}function b(o){return Math.floor(o*.5)}function _(o,t,i=1,n){const l=Math.round(t*o),e=n?i:Math.round(i*t),s=b(e);return{position:l-s,length:e}}function w(o,t,i){const n=Math.round(i*o),l=Math.round(i*t);return{position:Math.min(n,l),length:Math.abs(l-n)+1}}class k{constructor(){C(this,"_data",null);C(this,"_options",null)}draw(t,i){t.useBitmapCoordinateSpace(n=>this._drawImpl(n,i))}update(t,i){this._data=t,this._options=i}_drawImpl(t,i){if(this._data===null||this._data.bars.length===0||this._data.visibleRange===null||this._options===null)return;let n=-1/0;const l=this._data.bars.map(s=>{const f=s.originalData.close>=n;n=s.originalData.close??n;const h=i(s.originalData.open)??0,c=i(s.originalData.high)??0,d=i(s.originalData.low)??0,u=i(s.originalData.close)??0;return{openY:h,highY:c,lowY:d,closeY:u,x:s.x,isUp:f}}),e=this._options.radius(this._data.barSpacing);this._drawWicks(t,l,this._data.visibleRange),this._drawCandles(t,l,this._data.visibleRange,e)}_drawWicks(t,i,n){if(this._data===null||this._options===null)return;const{context:l,horizontalPixelRatio:e,verticalPixelRatio:s}=t,f=M(e);for(let h=n.from;h<n.to;h++){const c=i[h];l.fillStyle=c.isUp?this._options.wickUpColor:this._options.wickDownColor;const d=w(c.lowY,c.highY,s),u=_(c.x,e,f);l.fillRect(u.position,d.position,u.length,d.length)}}_drawCandles(t,i,n,l){if(this._data===null||this._options===null)return;const{context:e,horizontalPixelRatio:s,verticalPixelRatio:f}=t,h=S(this._data.barSpacing,1);for(let c=n.from;c<n.to;c++){const d=i[c],u=w(Math.min(d.openY,d.closeY),Math.max(d.openY,d.closeY),f),g=_(d.x,s,h);e.fillStyle=d.isUp?this._options.upColor:this._options.downColor,e.roundRect?(e.beginPath(),e.roundRect(g.position,u.position,g.length,u.length,l),e.fill()):e.fillRect(g.position,u.position,g.length,u.length)}}}const x={...r.customSeriesDefaultOptions,upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350",radius:function(o){return o<4?0:o/3}};class P{constructor(){C(this,"_renderer");this._renderer=new k}priceValueBuilder(t){return[t.high,t.low,t.close]}renderer(){return this._renderer}isWhitespace(t){return t.close===void 0}update(t,i){this._renderer.update(t,i)}defaultOptions(){return x}}a.RoundedCandleSeries=P,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
