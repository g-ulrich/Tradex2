(function(a,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("lightweight-charts")):typeof define=="function"&&define.amd?define(["exports","lightweight-charts"],r):(a=typeof globalThis<"u"?globalThis:a||self,r(a.UserPriceLines={},a.LightweightCharts))})(this,function(a,r){"use strict";var B=Object.defineProperty;var V=(a,r,h)=>r in a?B(a,r,{enumerable:!0,configurable:!0,writable:!0,value:h}):a[r]=h;var s=(a,r,h)=>(V(a,typeof r!="symbol"?r+"":r,h),h);function h(o){if(o===void 0)throw new Error("Value is undefined");return o}class f{constructor(){s(this,"_chart");s(this,"_series");s(this,"_requestUpdate");s(this,"_fireDataUpdated",t=>{this.dataUpdated&&this.dataUpdated(t)})}requestUpdate(){this._requestUpdate&&this._requestUpdate()}attached({chart:t,series:e,requestUpdate:i}){this._chart=t,this._series=e,this._series.subscribeDataChanged(this._fireDataUpdated),this._requestUpdate=i,this.requestUpdate()}detached(){var t;(t=this._series)==null||t.unsubscribeDataChanged(this._fireDataUpdated),this._chart=void 0,this._series=void 0,this._requestUpdate=void 0}get chart(){return h(this._chart)}get series(){return h(this._series)}}function v(o){return Math.floor(o*.5)}function b(o,t,e=1,i){const n=Math.round(t*o),u=i?e:Math.round(e*t),c=v(u);return{position:n-c,length:u}}function P(o,t,e){const i=Math.round(e*o),n=Math.round(e*t);return{position:Math.min(i,n),length:Math.abs(n-i)+1}}const d=21,C="M7.5,7.5 m -7,0 a 7,7 0 1,0 14,0 a 7,7 0 1,0 -14,0 M4 7.5H11 M7.5 4V11",g=new Path2D(C),m=15;class w{constructor(t){s(this,"_y",0);s(this,"_data");this._data=t}update(t,e){if(this._data=t,!this._data.price){this._y=-1e4;return}this._y=e.priceToCoordinate(this._data.price)??-1e4}}class L{constructor(t){s(this,"_data");this._data=t}draw(t){this._data.visible&&t.useBitmapCoordinateSpace(e=>{const i=e.context,n=d,u=n+1,c=P(this._data.rightX-u,this._data.rightX-1,e.horizontalPixelRatio),l=b(this._data.y,e.verticalPixelRatio,n);i.fillStyle=this._data.color;const _=[5,0,0,5].map(S=>S*e.horizontalPixelRatio);i.beginPath(),i.roundRect(c.position,l.position,c.length,l.length,_),i.fill(),this._data.hovered&&(i.fillStyle=this._data.hoverColor,i.beginPath(),i.roundRect(c.position,l.position,c.length,l.length,_),i.fill()),i.translate(c.position+3*e.horizontalPixelRatio,l.position+3*e.verticalPixelRatio),i.scale(e.horizontalPixelRatio,e.verticalPixelRatio);const p=15/m;i.scale(p,p),i.strokeStyle=this._data.textColor,i.lineWidth=1,i.stroke(g)})}}class M extends w{renderer(){const t=this._data.crosshairColor;return new L({visible:this._data.visible,y:this._y,color:t,textColor:this._data.crosshairLabelColor,rightX:this._data.timeScaleWidth,hoverColor:this._data.hoverColor,hovered:this._data.hovered??!1})}zOrder(){return"top"}}class U extends f{constructor(e){super();s(this,"_paneViews");s(this,"_data",{visible:!1,hovered:!1,timeScaleWidth:0,crosshairLabelColor:"#000000",crosshairColor:"#ffffff",lineColor:"#000000",hoverColor:"#777777"});s(this,"_source");this._paneViews=[new M(this._data)],this._source=e}updateAllViews(){this._paneViews.forEach(e=>e.update(this._data,this.series))}priceAxisViews(){return[]}paneViews(){return this._paneViews}showAddLabel(e,i){const n=this.chart.options().crosshair.horzLine.labelBackgroundColor;this._data={visible:!0,price:e,hovered:i,timeScaleWidth:this.chart.timeScale().width(),crosshairColor:n,crosshairLabelColor:"#FFFFFF",lineColor:this._source.currentLineColor(),hoverColor:this._source.currentHoverColor()},this.updateAllViews(),this.requestUpdate()}hideAddLabel(){this._data.visible=!1,this.updateAllViews(),this.requestUpdate()}}const x={color:"#000000",hoverColor:"#777777",limitToOne:!0};class y{constructor(t,e,i){s(this,"_chart");s(this,"_series");s(this,"_options");s(this,"_labelButtonPrimitive");s(this,"_clickHandler",t=>this._onClick(t));s(this,"_moveHandler",t=>this._onMouseMove(t));this._chart=t,this._series=e,this._options={...x,...i},this._chart.subscribeClick(this._clickHandler),this._chart.subscribeCrosshairMove(this._moveHandler),this._labelButtonPrimitive=new U(this),e.attachPrimitive(this._labelButtonPrimitive),this._setCrosshairMode()}currentLineColor(){return this._options.color}currentHoverColor(){return this._options.hoverColor}_setCrosshairMode(){if(!this._chart)throw new Error("Unable to change crosshair mode because the chart instance is undefined");this._chart.applyOptions({crosshair:{mode:r.CrosshairMode.Normal}})}remove(){this._chart&&(this._chart.unsubscribeClick(this._clickHandler),this._chart.unsubscribeCrosshairMove(this._moveHandler)),this._series&&this._labelButtonPrimitive&&this._series.detachPrimitive(this._labelButtonPrimitive),this._chart=void 0,this._series=void 0}_onClick(t){const e=this._getMousePrice(t),i=this._distanceFromRightScale(t);e===null||i===null||i>d||!this._series||this._series.createPriceLine({price:e,color:this._options.color,lineStyle:r.LineStyle.Dashed})}_onMouseMove(t){const e=this._getMousePrice(t),i=this._distanceFromRightScale(t);if(e===null||i===null||i>d*2){this._labelButtonPrimitive.hideAddLabel();return}this._labelButtonPrimitive.showAddLabel(e,i<d)}_getMousePrice(t){return!t.point||!this._series?null:this._series.coordinateToPrice(t.point.y)}_distanceFromRightScale(t){if(!t.point||!this._chart)return null;const e=this._chart.timeScale().width();return Math.abs(e-t.point.x)}}a.UserPriceLines=y,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
