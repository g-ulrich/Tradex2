(function(a,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a.VolumeProfile={}))})(this,function(a){"use strict";var m=Object.defineProperty;var f=(a,e,r)=>e in a?m(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var n=(a,e,r)=>(f(a,typeof e!="symbol"?e+"":e,r),r);function e(c,t,o){const s=Math.round(o*c),i=Math.round(o*t);return{position:Math.min(s,i),length:Math.abs(i-s)+1}}class r{constructor(t){n(this,"_data");this._data=t}draw(t){t.useBitmapCoordinateSpace(o=>{if(this._data.x===null||this._data.top===null)return;const s=o.context,i=e(this._data.x,this._data.x+this._data.width,o.horizontalPixelRatio),_=e(this._data.top,this._data.top-this._data.columnHeight*this._data.items.length,o.verticalPixelRatio);s.fillStyle="rgba(0, 0, 255, 0.2)",s.fillRect(i.position,_.position,i.length,_.length),s.fillStyle="rgba(80, 80, 255, 0.8)",this._data.items.forEach(l=>{if(l.y===null)return;const h=e(l.y,l.y-this._data.columnHeight,o.verticalPixelRatio),u=e(this._data.x,this._data.x+l.width,o.horizontalPixelRatio);s.fillRect(u.position,h.position,u.length,h.length-2)})})}}class d{constructor(t){n(this,"_source");n(this,"_x",null);n(this,"_width",6);n(this,"_columnHeight",0);n(this,"_top",null);n(this,"_items",[]);this._source=t}update(){const t=this._source._vpData,o=this._source._series,s=this._source._chart.timeScale();this._x=s.timeToCoordinate(t.time),this._width=s.options().barSpacing*t.width;const i=o.priceToCoordinate(t.profile[0].price)??0,_=o.priceToCoordinate(t.profile[1].price)??s.height();this._columnHeight=Math.max(1,i-_);const l=t.profile.reduce((h,u)=>Math.max(h,u.vol),0);this._top=i,this._items=t.profile.map(h=>({y:o.priceToCoordinate(h.price),width:this._width*h.vol/l}))}renderer(){return new r({x:this._x,top:this._top,columnHeight:this._columnHeight,width:this._width,items:this._items})}}class p{constructor(t,o,s){n(this,"_chart");n(this,"_series");n(this,"_vpData");n(this,"_minPrice");n(this,"_maxPrice");n(this,"_paneViews");n(this,"_vpIndex",null);this._chart=t,this._series=o,this._vpData=s,this._minPrice=1/0,this._maxPrice=-1/0,this._vpData.profile.forEach(i=>{i.price<this._minPrice&&(this._minPrice=i.price),i.price>this._maxPrice&&(this._maxPrice=i.price)}),this._paneViews=[new d(this)]}updateAllViews(){this._paneViews.forEach(t=>t.update())}autoscaleInfo(t,o){const s=this._chart.timeScale().timeToCoordinate(this._vpData.time);if(s===null)return null;const i=this._chart.timeScale().coordinateToLogical(s);return i===null||o<i||t>i+this._vpData.width?null:{priceRange:{minValue:this._minPrice,maxValue:this._maxPrice}}}paneViews(){return this._paneViews}}a.VolumeProfile=p,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
