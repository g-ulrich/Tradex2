(function(u,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("lightweight-charts")):typeof define=="function"&&define.amd?define(["exports","lightweight-charts"],d):(u=typeof globalThis<"u"?globalThis:u||self,d(u.BoxWhiskerSeries={},u.LightweightCharts))})(this,function(u,d){"use strict";var B=Object.defineProperty;var L=(u,d,f)=>d in u?B(u,d,{enumerable:!0,configurable:!0,writable:!0,value:f}):u[d]=f;var m=(u,d,f)=>(L(u,typeof d!="symbol"?d+"":d,f),f);const f={...d.customSeriesDefaultOptions,whiskerColor:"rgba(106, 27, 154, 1)",lowerQuartileFill:"rgba(103, 58, 183, 1)",upperQuartileFill:"rgba(233, 30, 99, 1)",outlierColor:"rgba(149, 152, 161, 1)"};function q(e){return Math.floor(e*.5)}function c(e,t,i=1,s){const r=Math.round(t*e),a=s?i:Math.round(i*t),l=q(a);return{position:r-l,length:a}}function p(e,t,i){const s=Math.round(i*e),r=Math.round(i*t);return{position:Math.min(s,r),length:Math.abs(r-s)+1}}function Y(e){return Math.max(1,Math.floor(e))}function _(e){return Y(e)/e}function k(e,t){if(e>=2.5&&e<=4)return Math.floor(3*t);const l=1-.2*Math.atan(Math.max(4,e)-4)/(Math.PI*.5),h=Math.floor(e*l*t),n=Math.floor(e*t),o=Math.min(h,n);return Math.max(Math.floor(t),o)}function M(e,t){let i=k(e,t);return i>=2&&Math.floor(t)%2!==i%2&&i--,i}function y(e){const t=M(e,1),i=Math.floor(e),s=M(e/2,1);return{body:t,medianLine:Math.max(i,t),extremeLines:s,outlierRadius:Math.min(t,4)}}class S{constructor(){m(this,"_data",null);m(this,"_options",null)}draw(t,i){t.useBitmapCoordinateSpace(s=>this._drawImpl(s,i))}update(t,i){this._data=t,this._options=i}_drawImpl(t,i){if(this._data===null||this._data.bars.length===0||this._data.visibleRange===null||this._options===null)return;const s=this._options,r=this._data.bars.map(n=>({quartilesY:n.originalData.quartiles.map(o=>i(o)??0),outliers:(n.originalData.outliers||[]).map(o=>i(o)??0),x:n.x})),a=y(this._data.barSpacing),l=_(t.horizontalPixelRatio),h=_(t.verticalPixelRatio);for(let n=this._data.visibleRange.from;n<this._data.visibleRange.to;n++){const o=r[n];a.outlierRadius>2&&this._drawOutliers(t.context,o,a.outlierRadius,s,t.horizontalPixelRatio,t.verticalPixelRatio),this._drawWhisker(t.context,o,a.extremeLines,s,t.horizontalPixelRatio,t.verticalPixelRatio,l,h),this._drawBox(t.context,o,a.body,s,t.horizontalPixelRatio,t.verticalPixelRatio),this._drawMedianLine(t.context,o,a.medianLine,s,t.horizontalPixelRatio,t.verticalPixelRatio,h)}}_drawWhisker(t,i,s,r,a,l,h,n){t.save(),t.fillStyle=r.whiskerColor;const o=c(i.x,a,h),P=p(i.quartilesY[0],i.quartilesY[1],l);t.fillRect(o.position,P.position,o.length,P.length);const w=p(i.quartilesY[3],i.quartilesY[4],l);t.fillRect(o.position,w.position,o.length,w.length);const g=c(i.x,a,s),W=c(i.quartilesY[4],l,n);t.fillRect(g.position,W.position,g.length,W.length);const C=c(i.quartilesY[0],l,n);t.fillRect(g.position,C.position,g.length,C.length),t.restore()}_drawBox(t,i,s,r,a,l){t.save();const h=p(i.quartilesY[2],i.quartilesY[3],l),n=p(i.quartilesY[1],i.quartilesY[2],l),o=c(i.x,a,s);t.fillStyle=r.lowerQuartileFill,t.fillRect(o.position,n.position,o.length,n.length),t.fillStyle=r.upperQuartileFill,t.fillRect(o.position,h.position,o.length,h.length),t.restore()}_drawMedianLine(t,i,s,r,a,l,h){const n=c(i.x,a,s),o=c(i.quartilesY[2],l,h);t.save(),t.fillStyle=r.whiskerColor,t.fillRect(n.position,o.position,n.length,o.length),t.restore()}_drawOutliers(t,i,s,r,a,l){t.save();const h=c(i.x,a,1,!0);t.fillStyle=r.outlierColor,t.lineWidth=0,i.outliers.forEach(n=>{t.beginPath();const o=c(n,l,1,!0);t.arc(h.position,o.position,s,0,2*Math.PI),t.fill(),t.closePath()}),t.restore()}}class v{constructor(){m(this,"_renderer");this._renderer=new S}priceValueBuilder(t){return[t.quartiles[4],t.quartiles[0],t.quartiles[2]]}isWhitespace(t){return t.quartiles===void 0}renderer(){return this._renderer}update(t,i){this._renderer.update(t,i)}defaultOptions(){return f}}u.WhiskerBoxSeries=v,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
