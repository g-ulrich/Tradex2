(function(a,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a.SessionHighlighting={}))})(this,function(a){"use strict";var S=Object.defineProperty;var D=(a,e,h)=>e in a?S(a,e,{enumerable:!0,configurable:!0,writable:!0,value:h}):a[e]=h;var s=(a,e,h)=>(D(a,typeof e!="symbol"?e+"":e,h),h);function e(d){if(d===void 0)throw new Error("Value is undefined");return d}class h{constructor(){s(this,"_chart");s(this,"_series");s(this,"_requestUpdate");s(this,"_fireDataUpdated",t=>{this.dataUpdated&&this.dataUpdated(t)})}requestUpdate(){this._requestUpdate&&this._requestUpdate()}attached({chart:t,series:i,requestUpdate:r}){this._chart=t,this._series=i,this._series.subscribeDataChanged(this._fireDataUpdated),this._requestUpdate=r,this.requestUpdate()}detached(){var t;(t=this._series)==null||t.unsubscribeDataChanged(this._fireDataUpdated),this._chart=void 0,this._series=void 0,this._requestUpdate=void 0}get chart(){return e(this._chart)}get series(){return e(this._series)}}class l{constructor(t){s(this,"_viewData");this._viewData=t}draw(t){const i=this._viewData.data;t.useBitmapCoordinateSpace(r=>{const c=r.context,m=0,b=r.bitmapSize.height,o=r.horizontalPixelRatio*this._viewData.barWidth/2,w=-1*(o+1),x=r.bitmapSize.width;i.forEach(u=>{const n=u.x*r.horizontalPixelRatio;if(n<w)return;c.fillStyle=u.color||"rgba(0, 0, 0, 0)";const _=Math.max(0,Math.round(n-o)),U=Math.min(x,Math.round(n+o));c.fillRect(_,m,U-_,b)})})}}class p{constructor(t){s(this,"_source");s(this,"_data");this._source=t,this._data={data:[],barWidth:6,options:this._source._options}}update(){const t=this._source.chart.timeScale();this._data.data=this._source._backgroundColors.map(i=>({x:t.timeToCoordinate(i.time)??-100,color:i.color})),this._data.data.length>1?this._data.barWidth=this._data.data[1].x-this._data.data[0].x:this._data.barWidth=6}renderer(){return new l(this._data)}zOrder(){return"bottom"}}const g={};class f extends h{constructor(i,r={}){super();s(this,"_paneViews");s(this,"_seriesData",[]);s(this,"_backgroundColors",[]);s(this,"_options");s(this,"_highlighter");this._highlighter=i,this._options={...g,...r},this._paneViews=[new p(this)]}updateAllViews(){this._paneViews.forEach(i=>i.update())}paneViews(){return this._paneViews}attached(i){super.attached(i),this.dataUpdated("full")}dataUpdated(i){this._backgroundColors=this.series.data().map(r=>({time:r.time,color:this._highlighter(r.time)})),this.requestUpdate()}}a.SessionHighlighting=f,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
